<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>http1.x 版本问题 | 小飞的博客</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/imgs/avatar.jpeg">
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.4d0e6560.css" as="style"><link rel="preload" href="/assets/js/app.6b0df02a.js" as="script"><link rel="preload" href="/assets/js/2.d05876c7.js" as="script"><link rel="preload" href="/assets/js/18.33aaff62.js" as="script"><link rel="prefetch" href="/assets/js/10.ffd3e786.js"><link rel="prefetch" href="/assets/js/11.138c62a9.js"><link rel="prefetch" href="/assets/js/12.c54fbf61.js"><link rel="prefetch" href="/assets/js/13.154888f1.js"><link rel="prefetch" href="/assets/js/14.951fd072.js"><link rel="prefetch" href="/assets/js/15.96e965a5.js"><link rel="prefetch" href="/assets/js/16.2563d3a6.js"><link rel="prefetch" href="/assets/js/17.6505b026.js"><link rel="prefetch" href="/assets/js/19.884c31f9.js"><link rel="prefetch" href="/assets/js/20.ba37b079.js"><link rel="prefetch" href="/assets/js/21.8a305ccb.js"><link rel="prefetch" href="/assets/js/22.142005e0.js"><link rel="prefetch" href="/assets/js/23.d2b09be3.js"><link rel="prefetch" href="/assets/js/24.29762f46.js"><link rel="prefetch" href="/assets/js/25.01d11347.js"><link rel="prefetch" href="/assets/js/26.d04eb654.js"><link rel="prefetch" href="/assets/js/27.f7e0a0f4.js"><link rel="prefetch" href="/assets/js/28.72a12f48.js"><link rel="prefetch" href="/assets/js/29.d68aa1d6.js"><link rel="prefetch" href="/assets/js/3.6262e7b2.js"><link rel="prefetch" href="/assets/js/4.35722598.js"><link rel="prefetch" href="/assets/js/5.854416d2.js"><link rel="prefetch" href="/assets/js/6.7a9e4d83.js"><link rel="prefetch" href="/assets/js/7.bfe1eaa9.js"><link rel="prefetch" href="/assets/js/8.39253767.js"><link rel="prefetch" href="/assets/js/9.a9bf6fcb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4d0e6560.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/imgs/avatar.jpeg" alt="小飞的博客" class="logo"> <span class="site-name can-hide">小飞的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/three/javascript/methods.html" class="nav-link">
  三小强
</a></div><div class="nav-item"><a href="/vue/sourceCode/computed.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/chrome/principle/chrome.html" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/http/edition/0.9.html" class="nav-link">
  HTTP
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/three/javascript/methods.html" class="nav-link">
  三小强
</a></div><div class="nav-item"><a href="/vue/sourceCode/computed.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/chrome/principle/chrome.html" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/http/edition/0.9.html" class="nav-link">
  HTTP
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>版本</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/http/edition/0.9.html" class="sidebar-link">0.9版本</a></li><li><a href="/http/edition/1.0.html" class="sidebar-link">1.0版本</a></li><li><a href="/http/edition/1.1.html" class="sidebar-link">1.1版本</a></li><li><a href="/http/edition/2.0.html" aria-current="page" class="active sidebar-link">2.0版本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/http/edition/2.0.html#http1-x-版本问题" class="sidebar-link">http1.x 版本问题</a></li><li class="sidebar-sub-header"><a href="/http/edition/2.0.html#http2-0" class="sidebar-link">http2.0</a></li><li class="sidebar-sub-header"><a href="/http/edition/2.0.html#头部压缩" class="sidebar-link">头部压缩</a></li><li class="sidebar-sub-header"><a href="/http/edition/2.0.html#多路复用" class="sidebar-link">多路复用</a></li><li class="sidebar-sub-header"><a href="/http/edition/2.0.html#服务器推送" class="sidebar-link">服务器推送</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>状态码</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>缓存</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>原理</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="http1-x-版本问题"><a href="#http1-x-版本问题" class="header-anchor">#</a> http1.x 版本问题</h2> <ul><li>在传输数据过程中，所有内容都是明文，客户端和服务器端都无法验证对方的身份，无法保证数据的安全性。</li> <li>HTTP/1.1 版本默认允许复用 TCP 连接，但是在同一个 TCP 连接里，所有数据通信是按次序进行的，服务器通常在处理完一个回应后，才会继续去处理下一个，这样子就会造成队头阻塞。</li></ul> <ul><li>http/1.x 版本支持 Keep-alive，用此方案来弥补创建多次连接产生的延迟，但是同样会给服务器带来压力，并且的话，对于单文件被不断请求的服务，Keep-alive 会极大影响性能，因为它在文件被请求之后还保持了不必要的连接很长时间。</li></ul> <h2 id="http2-0"><a href="#http2-0" class="header-anchor">#</a> http2.0</h2> <ul><li><strong>二进制分帧</strong> 这是一次彻底的二进制协议，头信息和数据体都是二进制，并且统称为&quot;帧&quot;：头信息帧和数据帧。</li></ul> <ul><li><strong>头部压缩</strong> HTTP 1.1 版本会出现 「User-Agent、Cookie、Accept、Server、Range」 等字段可能会占用几百甚至几千字节，而 Body 却经常只有几十字节，所以导致头部偏重。HTTP 2.0 使用 HPACK 算法进行压缩。</li> <li><strong>多路复用</strong> 复用 TCP 连接，在一个连接里，客户端和浏览器都可以同时发送多个请求或回应，且不用按顺序一一对应，这样子解决了队头阻塞的问题。</li> <li><strong>服务器推送</strong> 允许服务器未经请求，主动向客户端发送资源，即服务器推送。</li> <li><strong>请求优先级</strong> 可以设置数据帧的优先级，让服务端先处理重要资源，优化用户体验。</li></ul> <h2 id="头部压缩"><a href="#头部压缩" class="header-anchor">#</a> 头部压缩</h2> <img src="/imgs/Hpack.png" alt="Hpack"> <ul><li>类似于索引表，每个索引表对应一个值，比如索引为 2 对应头部中的 method 头部信息，这样子的话，在传输的时候，不在是传输对应的头部信息了，而是传递索引，对于之前出现过的头部信息，只需要把「索引」(比如 1，2，...)传给对方即可，对方拿到索引查表就行了。</li></ul> <p>简单来说，头部压缩需要在支持 HTTP/2 的浏览器和服务端之间：</p> <ul><li>维护一份相同的静态字典（Static Table），包含常见的头部名称，以及特别常见的头部名称与值的组合；</li></ul> <ul><li><p>维护一份相同的动态字典（Dynamic Table），可以动态地添加内容；</p></li> <li><p>支持基于静态哈夫曼码表的哈夫曼编码（Huffman Coding）；</p> <p>1.静态字典的作用主要是对于完全匹配的头部键值对，直接使用一个字符来表示。<br>
2.浏览器也可以告知服务端，将键值对添加到动态字典中，这样后续整个键值对就可以使用一个字符表示了。<br>
3.静态字典在首次请求中就可以使用。对于静态、动态字典中不存在的内容，还可以使用哈夫曼编码来减小体积。<br>
4.哈夫曼编码的原理就是先将所有出现的字符建立一张索引表，然后让出现次数多的字符对应的索引尽可能短，传输的时候也是传输这样的「索引序列」，可以达到非常高的压缩率</p></li></ul> <h2 id="多路复用"><a href="#多路复用" class="header-anchor">#</a> 多路复用</h2> <p>为什么 HTTP/1.1 不能实现“多路复用”？</p> <p>HTTP/2 是基于二进制“帧”的协议，HTTP/1.1 是基于“文本分割”解析的协议。</p> <h3 id="帧和流"><a href="#帧和流" class="header-anchor">#</a> 帧和流</h3> <p>帧代表着最小的数据单位，每个帧会标识出该帧属于哪个流，流也就是多个帧组成的数据流。</p> <ul><li>报文格式就被拆分为一个个二进制帧，用「Headers 帧」存放头部字段，「Data 帧」存放请求体数据。这样子的话，就是一堆乱序的二进制帧，它们不存在先后关系，因此不需要排队等待，解决了 HTTP 队头阻塞问题。</li></ul> <ul><li>在客户端与服务器之间，双方都可以互相发送二进制帧，这样子「双向传输的序列」，称为流，所以 HTTP/2 中以流来表示一个 TCP 连接上进行多个数据帧的通信----多路复用。</li></ul> <p>乱序的二进制帧，如何组装成对于的报文呢？</p> <ul><li>所谓的乱序，值的是不同 ID 的 Stream 是乱序的，对于同一个 Stream ID 的帧是按顺序传输的。</li> <li>接收方收到二进制帧后，将相同的 Stream ID 组装成完整的请求报文和响应报文。</li></ul> <ul><li>二进制帧中有一些字段，控制着<code>优先级</code>和<code>流量控制</code>等功能，这样子的话，就可以设置数据帧的优先级，让服务器处理重要资源，优化用户体验。</li></ul> <h2 id="服务器推送"><a href="#服务器推送" class="header-anchor">#</a> 服务器推送</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/http/edition/1.1.html" class="prev">
        1.1版本
      </a></span> <span class="next"><a href="/http/code/1xx.html">
        1xx
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6b0df02a.js" defer></script><script src="/assets/js/2.d05876c7.js" defer></script><script src="/assets/js/18.33aaff62.js" defer></script>
  </body>
</html>
